<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binance OHLCV Data Analysis</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body { padding-top: 20px; }
        .container { max-width: 1200px; }
        .plot-container { margin-top: 30px; text-align: center; }
        img { max-width: 100%; height: auto; border: 1px solid #ddd; border-radius: 4px; padding: 5px; }
        .form-inline .form-control { margin-right: 10px; }
        .table-container { margin-top: 30px; }
        pre { background-color: #f8f9fa; padding: 15px; border-radius: 5px; text-align: left; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">Binance OHLCV Data with SMAs and Strategy Returns</h1>

        <p>This tool fetches daily OHLCV data from Binance, calculates 120-day and 365-day Simple Moving Averages (SMAs) of the close price, and a custom strategy return. The strategy return is defined as:</p>
        <ul>
            <li><code>(close - open) / open</code> if <code>open &gt; SMA_120</code> AND <code>open &gt; SMA_365</code></li>
            <li><code>-( (close - open) / open )</code> if <code>open &lt; SMA_120</code> AND <code>open &lt; SMA_365</code></li>
            <li><code>0</code> otherwise</li>
        </ul>

        <form class="form-inline mb-4" action="/" method="get">
            <div class="form-group">
                <label for="symbol" class="sr-only">Symbol:</label>
                <input type="text" class="form-control" id="symbol" name="symbol" value="{{ symbol | default('BTCUSDT') }}" placeholder="e.g., BTCUSDT">
            </div>
            <div class="form-group">
                <label for="interval" class="sr-only">Interval:</label>
                <input type="text" class="form-control" id="interval" name="interval" value="{{ interval | default('1d') }}" placeholder="e.g., 1d, 4h">
            </div>
            <div class="form-group">
                <label for="start_date" class="sr-only">Start Date:</label>
                <input type="text" class="form-control" id="start_date" name="start_date" value="{{ start_str | default('1 Jan, 2018') }}" placeholder="e.g., 1 Jan, 2018">
            </div>
            <button type="submit" class="btn btn-primary">Fetch & Plot</button>
        </form>

        {% if error_message %}
            <div class="alert alert-danger" role="alert">
                Error: {{ error_message }}
            </div>
        {% endif %}

        {% if plot_image %}
            <div class="plot-container">
                <h3>Analysis Plot for {{ symbol }}</h3>
                <img src="data:image/png;base64,{{ plot_image }}" alt="Analysis Plot">
            </div>

            <div class="table-container">
                <h4>Last 5 Rows of Processed Data:</h4>
                <div class="table-responsive">
                    {{ details_df | safe }}
                </div>
            </div>
        {% else %}
            <div class="alert alert-info" role="alert">
                No plot available. Please ensure valid parameters and API keys are set.
            </div>
        {% endif %}

    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
